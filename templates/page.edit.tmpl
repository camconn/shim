{{define "editPage"}}
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>SHIM | Editor</title>
		{{ template "stylesheets" $ }}
	</head>
	<body>
		{{ template "navbar" $ }}

		<div id="content" class="content">
			<h1>Edit Post</h1>
			{{- template "messages" $ -}}
			{{- $Post := .Post -}}
			<form action="{{ $.Base | html }}{{ $.URL | html -}}" method="post" class="container is-fluid">
				<input class="input is-large" type="text" name="title" value="{{- $Post.Title | html -}}" placeholder="Your Post's Title">

				<textarea class="textarea monospace editor" name="articleSrc" id="articleSrc" placeholder="Write some stuff here...">{{- printf "%s" $Post.GetBody | html -}}</textarea>
				<div class="columns">
					<div class="column is-4">
						{{- if $Post.Draft -}}
						<input type="checkbox" class="input toggle-button-common toggle-button-text" name="doPublish" id="publishToggle">
						{{- else -}}
						<input type="checkbox" class="input toggle-button-common toggle-button-text" name="doPublish" id="publishToggle" checked>
						{{- end -}}
						<label for="publishToggle" data-on="Publish" data-off="Draft"></label>
					</div>
					<div class="column is-4">
						<a class="input button is-info is-outlined" href="{{ $.Base }}/preview/{{- $Post.PreviewPath -}}">Preview</a>
					</div>
					<div class="column is-4">
						<input class="input button is-primary" type="submit" value="Save">
					</div>
				</div>

				<noscript>
					<div>
						<style type="text/css">
						/* Workaround for whenever the client doesn't have JS enabled */
						#collapse {
							display: inline !important;
						}
						#toggleButtonDiv {
							display: none !important;
						}
						</style>
					</div>
				</noscript>
				<script type="text/javascript">
				function toggleCollapse() {
					var coll = document.getElementById("collapse");
					if (coll === null) { return; }
					dis = coll.style.display;
					if (dis === "inline") {
						coll.style.display = "none";
						console.log("now hidden")
					} else {
						coll.style.display = "inline";
						console.log("now visible")
					}
				}
				</script>
				<div id="toggleButtonDiv">
					<p><a onclick="toggleCollapse()"><span class="toggle-div">+</span>Click to show post properties.</a></p>
					<br />
				</div>
				<div id="collapse">
					<div class="columns">
							<div class="column is-third">
								<p><code>author</code>: the author for this post</p>
							</div>
						<div class="column">
							<input class="input" type="text" name="author" value="{{- $Post.Author -}}">
						</div>
					</div>

					<div class="columns">
							<div class="column is-third">
								<p><code>description</code>: a short summary of the post &mdash; if none is provided, it will automatically be generated</p>
							</div>
						<div class="column">
							<input class="input" type="text" name="description" value="{{- $Post.ActualDescription -}}">
						</div>
					</div>

					<div class="columns">
							<div class="column is-third">
								<p><code>slug</code>: the token to appear in the tail of the url &mdash; if none is provided, the filename will be used</p>
							</div>
						<div class="column">
							<input class="input" type="text" name="slug" value="{{- $Post.Slug -}}">
						</div>
					</div>

					<div class="columns">
						<div class="column is-third">
							<p><code>published</code>: the date and time when this post was published</p>
						</div>
						<div class="column">
							{{- if $Post.Draft -}}
							<p>You must first publish this post to set the publish time. The publish time will be set automatically when published.</p>
							{{- else -}}
							<input class="input" type="text" name="published" value="{{- $Post.WebDate | html -}}" placeholder="25 Dec 2000 @ 23:59">
							{{- end -}}
						</div>
					</div>

					<div class="columns">
							<div class="column is-third">
								<p><code>aliases</code>: a comma-separated list of absolute URIs for this post which will redirect to this post</p>
							</div>
						<div class="column">
							<input class="input" type="text" name="aliases" value="{{- $Post.WebAliases | html -}}" placeholder="/my-cool-post/, /2010/04/28/my-cool-post/">
						</div>
					</div>

					{{- range $name, $joined := $Post.TaxonomyMap -}}
					<div class="columns">
						<div class="column is-quarter">
							<p class="title">{{- $name | html -}}</p>
						</div>
						<div class="column">
							<input class="input" type="text" name='{{- printf "taxonomy.%s" $name | html -}}' value="{{- $joined | html -}}">
						</div>
					</div>
					{{- end -}}
					<p class="is-text-right"><i><a href="{{ $.Base }}/taxonomy">Taxonomies</a> are a list of words separated by commas. All spaces are removed.</i></p>
				</div>

			</form>
		</div>

		{{template "footer"}}

		<link rel="stylesheet" href="{{ $.Base }}/static/editor/simplemde.min.css">
		<script type="text/javascript">document.getElementById("collapse").style.display = "none";</script>
		<script src="{{ $.Base }}/static/editor/simplemde.min.js"></script>
		<script>
			var textarea = document.getElementById('articleSrc'),
				editor = new SimpleMDE({ element: textarea, spellChecker: false });

			function updateText() {
				textarea.value = editor.value();
				console.log(textarea.value);
			}

			editor.codemirror.on('change', updateText);
			editor.codemirror.on('keyup', updateText);
		</script>
	</body>
</html>
{{end}}
